<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <link rel="stylesheet" href="../css/custom.css">
</head>
<body>


<script>
    var width=1e3,height=375,graph=d3.select("body").append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox",[0,0,width,height]).style("display","block").style("margin","auto"),initial_state={x:.1,y:.1},dt=.01,T=75,plot_delay=20,N_points=25,N_particles=1e3;function f(t){var a=t.x,t=t.y;return{x:t,y:(1-a*a)*t-a}}function euler(t){var a=f(t);return{x:t.x+dt*a.x,y:t.y+dt*a.y}}var states=[initial_state],graph_margin={top:10,right:10,bottom:10,left:10},xScale=d3.scaleLinear().domain([-4,4]).range([graph_margin.left,width-graph_margin.right]),yScale=d3.scaleLinear().domain([-4,4]).range([height-graph_margin.bottom,graph_margin.top]),xAxis=d3.axisBottom(xScale),yAxis=d3.axisLeft(yScale);graph.append("g").attr("transform","translate(0,"+(height/2-graph_margin.top)+")").call(xAxis),graph.append("g").attr("transform","translate("+width/2+",0)").call(yAxis),graph.append("g").attr("class","grid").attr("transform","translate(0,"+(height-graph_margin.top)+")").call(xAxis.tickSize(-height+graph_margin.top+graph_margin.bottom).tickFormat("").ticks(N_points)).style("color","#CECECE").call(t=>t.select(".domain").remove()),graph.append("g").attr("class","grid").attr("transform","translate("+graph_margin.left+",0)").call(yAxis.tickSize(-width+graph_margin.left+graph_margin.right).tickFormat("").ticks(N_points)).style("color","#CECECE").call(t=>t.select(".domain").remove());var x_label=graph.append("g").attr("transform","translate("+(width-10)+","+(height/2-20)+")"),y_label=graph.append("g").attr("transform","translate("+(width/2+20)+",30)");x_label.append("text").attr("text-anchor","end").attr("x",0).attr("y",0).text("position").style("font-family","sans-serif").style("font-size","20px"),y_label.append("text").attr("text-anchor","start").attr("x",0).attr("y",0).text("velocity").style("font-family","sans-serif").style("font-size","20px");var line=d3.line().x(function(t,a){return xScale(t.x)}).y(function(t){return yScale(t.y)});graph.append("path").attr("id","x_path").datum(states).attr("fill","none").attr("stroke","steelblue").attr("stroke-width",1.5).attr("d",line);var lines=[],defs=graph.append("svg:defs");function draw_vector_field(){for(var t=8/N_points*.8,a=[],r=[],e=N_points,i=0;i<e+1;i++)for(var n=0;n<e+1;n++){var l=f({x:8*i/e-4,y:8*n/e-4});a.push(l.x),r.push(l.y)}for(var p=d3.scaleSequential().interpolator(d3.interpolateCool).domain([0,1]),s=Math.max(...a),o=Math.max(...r),c=Math.sqrt(s*s+o*o),i=0;i<e+1;i++)for(n=0;n<e+1;n++){var d=8*i/e-4,h=8*n/e-4,g=a[i*(e+1)+n],y=r[i*(e+1)+n],x=Math.sqrt(g*g+y*y+1e-5),m=x/c,g=g/x*t,y=y/x*t,m=graph.append("line").attr("x1",xScale(d)).attr("y1",yScale(h)).attr("x2",xScale(d)).attr("y2",yScale(h)).attr("stroke-width",1.5).attr("stroke",p(m)).attr("marker-end",function(t){(!(t=""+t)||t.indexOf("rgb")<0)&&(t=d3.rgb(t).toString());return t="#"+(t=(t=(t=t.replace("rgb(","").replace(")","")).split(",").map(function(t){return parseInt(t)})).map(function(t){return("0"+t.toString(16)).slice(-2)})).join(""),defs.append("svg:marker").attr("id",t.replace("#","")).attr("refX",3).attr("refY",2).attr("markerWidth",6).attr("markerHeight",4).attr("orient","auto").append("path").attr("d","M 0,0 V 4 L6,2 Z").style("fill",t),"url("+t+")"}(p(m))).style("opacity",1).attr("z-index","100");m.transition().duration(1e3).attr("x2",xScale(d+g)).attr("y2",yScale(h+y)),lines.push(m)}}var interval,particle_set=graph.append("g").attr("id","particle_set"),particles=[];function update_particles(){for(var t=0;t<particles.length;t++){var a=particles[t],r={x:a.x,y:a.y},e=f(r);a.x=r.x+e.x*dt,a.y=r.y+e.y*dt,a.t+=1,a.t>T&&(a.x=8*Math.random()-4,a.y=8*Math.random()-4,a.t=0),a.path.attr("cx",xScale(a.x)).attr("cy",yScale(a.y)).style("opacity",1-a.t/T)}}function erase_particles(){for(var t=0;t<particles.length;t++)particles[t].path.remove();particles=[],clearInterval(interval)}function draw_particles(t){if(particles.length>t)for(;particles.length>t;)p=particles.pop(),p.path.transition().duration(500).style("opacity",0).remove();else for(;particles.length<t;){var a={x:8*Math.random()-4,y:8*Math.random()-4,t:Math.random()*T};a.path=particle_set.append("circle").attr("cx",xScale(a.x)).attr("cy",yScale(a.y)).attr("r",4).attr("stroke","black").attr("stroke-width",.5).attr("fill",d3.interpolateRainbow(Math.random())).style("opacity",0),particles.push(a),a.path.transition().duration(500).style("opacity",1)}interval=setInterval(update_particles,plot_delay)}draw_particles(100);var _transitions=[{transitionForward:()=>draw_particles(1e3),transitionBackward:()=>draw_particles(100),index:0}];
</script>
</body>
</html>